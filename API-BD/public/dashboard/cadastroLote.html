<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSensor | Cadastro de Caminhão</title>
    <link rel="stylesheet" href="../css/cadastroLote.css">
    <link rel="shortcut icon" href="../assets/imagens/favicon.png" type="image/x-icon">
    <script src="../js/sessao.js"></script>
</head>

<body>

    <div id="menuLateral">
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>

        <h1>Code<br><span id="sensor">Sensor</span></h1>

        <h2>Olá, Claudio</h2>

        <div id="containerBotoes">

            <a id="botaoInicial" href="DashboardPaginaInicial.html">PÁGINA INICIAL</a>
            <a class="botao" href="tela_caminhoesRegistrados.html">CAMINHÕES</a>
            <a class="botao" href="opcoesCadastro.html">CADASTRO</a>

            <a id="botaoSair" href="../Site Institucional/public/index.html">SAIR</a>

        </div>

    </div>

    <div id="containerCadastro">

        <div class="containerTitulo">
            <h1 class="titulo">
                CADASTRO DE LOTE
            </h1>
        </div>
        <div id="card">
            <div id="container-card">
                <div id="historicoCadastro">
                    <div id="tituloLoteEsquerda">
                        <h1>LOTES RECENTEMENTE</h1>
                        <h1>CADASTRADOS</h1>
                    </div>
                    <div id="card-lotesCadastrados">
                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 1</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Bovina
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 20
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> AAAA111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 3</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Ave
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 18
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> ACAA111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 5</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Ave
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 21
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> AEAA111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 7</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Suína
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 40
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> ABDC111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 2</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Suína
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 19
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> ABAA111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 4</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Bovina
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 19
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> ADAA111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 6</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Bovina
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 40
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> AFAA111
                                </span>
                            </div>
                        </div>

                        <div class="card-lote">
                            <div class="card-lote-titulo">
                                <h2>Lote 8</h2>
                            </div>
                            <div class="dados-lote">
                                <span class="especificacao">
                                    <span class="negrito">Tipo de carne:</span class="negrito"> Ave
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Carnes embaladas:</span class="negrito"> 25
                                </span>
                                <span class="especificacao">
                                    <span class="negrito">Placa do veículo:</span class="negrito"> GHFE123
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="insertDados">
                    <div id="fechar">
                        <button onclick="voltarTela()">×</button>
                    </div>
                    <div id="tituloLoteDireita">
                        <h1>INSIRA OS DADOS DO</h1>
                        <h1>LOTE</h1>
                    </div>
                    <div id="tresInputs">
                        <div class="inputPadronizado">
                            <label for="tipoCarne" id="tipo_carne">Tipo de Carne</label>
                            <div class="inputLinha">
                                <input id="tipoCarne">
                            </div>
                        </div>

                        <div class="inputPadronizado">
                            <label for="carnesEmbaladas" id="carnes_embaladas">Carnes embaladas</label>
                            <div class="inputLinha">
                                <input id="carnesEmbaladas">
                            </div>
                        </div>
                        <div class="inputPadronizado">
                            <label for="placa" id="placa_caminhao">Placa do Caminhão</label>
                            <div class="inputLinha">
                                <input id="input_placa">
                            </div>
                        </div>
                        <div id="bota-cadastrarLote">
                            <button onclick="cas()">Cadastrar Lote</button>
                        </div>
                        <div id="div_aguardar" class="loading-div">
                            <img src="../assets/circle-loading.gif" id="loading-gif" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</body>

</html>
<script>

    var fkEmpresa = sessionStorage.ID_EMPRESA;


    function cas() {

        aguardar();

        var carneVar = tipoCarne.value;
        var qtdCarneVar = carnesEmbaladas.value;
        var placa = input_placa.value;

        if (carneVar != '' && qtdCarneVar != '' && placa != '') {
            setInterval(sumirMensagem, 5000);
        } else {
            alert("Não aceitamos campos vazios");
            finalizarAguardar();
            return false;
        }

        if (carneVar != "Bovina" && carneVar != "Ave" && carneVar != "Suína") {
            alert("Apenas são aceitos os seguintes tipo de carne: Bovina, Ave, Suína");
        } else {
            aguardar();
            fetch(`/usuarios/cadastrarLote/${fkEmpresa}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    carneServer: carneVar,
                    qtdCarneServer: qtdCarneVar,
                    placaServer: placa,
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        cardErro.style.display = "block";

                        mensagem_erro.innerHTML =
                            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
                        alert("Cadastro realizado com sucesso!")

                        setTimeout(() => {
                            window.location = "cadastroLote.html";
                        }, "2000");

                        limparFormulario();
                        finalizarAguardar();
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                    finalizarAguardar();
                });


        }

    }





    function voltarTela() {
        window.location = "opcoesCadastro.html";
    }

    function sumirMensagem() {
        cardErro.style.display = "none";
    }

</script>