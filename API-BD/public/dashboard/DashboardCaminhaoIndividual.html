<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSensor | Caminhão Individual</title>
    <link rel="stylesheet" href="../css/DashboardCaminhaoIndividual.css">
    <link rel="shortcut icon" href="../assets/imagens/favicon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div id="menuLateral">

        <h1>Code<br><span id="sensor">Sensor</span></h1>

        <h2>Olá, Claudio</h2>

        <div id="containerBotoes">

            <a id="botaoInicial" href="DashboardPaginaInicial.html">PÁGINA INICIAL</a>
            <a class="botao" href="tela_caminhoesRegistrados.html">CAMINHÕES</a>

            <a id="botaoSair" href="../Site Institucional/public/index.html">SAIR</a>

        </div>

    </div>

    <div id="containerTudo">

        <div class="containerTitulo">

            <h1 class="titulo">
                CAMINHÃO - <span id="placaTitulo">-</span>
            </h1>

        </div>

        <div id="containerKpi">
            <div class="kpi" id="kpiTemperatura">
                <img src="../assets/imagens/temperaturaIdeal.png" alt="">
                <span>
                    TEMPERATURA MAIS RECENTE
                    <h2 id="temperaturaMaisRecente"></h2>
                    <h6 id="statusTemperatura"></h6>
                </span>
            </div>

            <div class="kpi" id="kpiUmidade">
                <img src="../assets/imagens/umidadeIdeal.png" alt="">
                <span>
                    UMIDADE MAIS RECENTE
                    <h2 id="UmidadeMaisRecente"></h2>
                    <h6 id="statusUmidade"></h6>
                </span>
            </div>

        </div>

        <div class="containerSubTitulo">

            <h2 class="subTitulo">
                TEMPERATURA
            </h2>

            <h2 class="subTitulo">
                UMIDADE
            </h2>

        </div>

        <div id="graficos">

            <div class="containerGrafico" id="esquerda">
                <br>
                <canvas id="temperatura"></canvas>

            </div>

            <div class="containerGrafico">

                <canvas id="umidade"></canvas>

            </div>

        </div>

    </div>

    </div>

</body>

</html>

<script>
    pegarTemperaturaMaisRecente()
    pegarUmidadeMaisRecente()
    mostrarDadosTemperatura()
    mostrarDadosUmidade()

    function pegarTemperaturaMaisRecente() {
      var placaCaminhao = sessionStorage.getItem('PLACA_CAMINHAO');
      placaTitulo.innerHTML = placaCaminhao;
        fetch(
            `/empresas/pegarTemperaturaMaisRecente/${placaCaminhao}`
        ).then(function (response) {
            if (response.ok) {

                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    sessionStorage.TEMPERATURA_MAIS_RECENTE = resposta[0].temperaturaRecente;
                    temperaturaMaisRecente.innerHTML = sessionStorage.getItem('TEMPERATURA_MAIS_RECENTE');

                })
            } else {

                console.log('Nenhum valor econtrado ou erro na API!');

            }

        })
            .catch(function (error) {

                console.log(`Erro na captura dos para a KPI ${error.message}`);

            });

        return false;

    }
    function pegarUmidadeMaisRecente() {
      var placaCaminhao = sessionStorage.getItem('PLACA_CAMINHAO');
        fetch(
            `/empresas/pegarUmidadeMaisRecente/${placaCaminhao}`
        ).then(function (response) {
            if (response.ok) {

                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    sessionStorage.UMIDADE_MAIS_RECENTE = resposta[0].umidadeRecente;
                    UmidadeMaisRecente.innerHTML = sessionStorage.getItem('UMIDADE_MAIS_RECENTE');

                })
            } else {

                console.log('Nenhum valor econtrado ou erro na API!');

            }

        })
            .catch(function (error) {

                console.log(`Erro na captura dos para a KPI ${error.message}`);
            });

        return false;

    }
    function mostrarDadosTemperatura() {

        var placaCaminhao = sessionStorage.getItem('PLACA_CAMINHAO');
   
    fetch(`/empresas/mostrarDadosTemperatura/${placaCaminhao}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error("Erro ao buscar os dados");
        }
        return response.json();
      })
      .then((data) => {
        const ctx = document.getElementById("temperatura").getContext("2d");

        const reversedData = data.reverse();

        const labels = reversedData.map((item) => item.dtLeitura);
        const dados = reversedData.map((item) => item.temperatura);

        console.log(labels, dados);

        new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: " Temperaturas registradas",
                color: "white",
                data: dados,
                backgroundColor: "#179928",
                borderColor: "#179928",
                borderWidth: 1,
              },
            ],
          },
          options: {
            plugins: {
              title: {
                display: true,
                text: "Temperaturas recentemente registradas",
                font: {
                  size: 20,
                },
                padding: {
                  top: 3,
                  bottom: 3,
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                  precision: 0,
                },
              },
            },
          },
        });
      })
      .catch((error) => {
        console.error("Erro no gráfico", error);
      });
}

function mostrarDadosUmidade() {

        var placaCaminhao = sessionStorage.getItem('PLACA_CAMINHAO');
   
    fetch(`/empresas/mostrarDadosUmidade/${placaCaminhao}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error("Erro ao buscar os dados");
        }
        return response.json();
      })
      .then((data) => {
        const ctx = document.getElementById("umidade").getContext("2d");

        const reversedData = data.reverse();

        const labels = reversedData.map((item) => item.dtLeitura);
        const dados = reversedData.map((item) => item.umidade);

        console.log(labels, dados);

        new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: " Umidades registradas",
                color: "white",
                data: dados,
                backgroundColor: "#179928",
                borderColor: "#179928",
                borderWidth: 1,
              },
            ],
          },
          options: {
            plugins: {
              title: {
                display: true,
                text: "Umidades recentemente registradas",
                font: {
                  size: 20,
                },
                padding: {
                  top: 3,
                  bottom: 3,
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                  precision: 0,
                },
              },
            },
          },
        });
      })
      .catch((error) => {
        console.error("Erro no gráfico", error);
      });
}


</script>