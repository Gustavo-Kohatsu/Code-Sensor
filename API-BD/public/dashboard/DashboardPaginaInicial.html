<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSensor | Página Inicial</title>
    <link rel="stylesheet" href="../css/PaginaInicialDashboard.css">
    <link rel="shortcut icon" href="../assets/imagens/favicon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div id="menuLateral">

        <h1>Code<br><span id="sensor">Sensor</span></h1>

        <h2>Olá, Claudio</h2>

        <div id="containerBotoes">

            <a id="botaoInicial" href="DashboardPaginaInicial.html">PÁGINA INICIAL</a>
            <a class="botao" href="tela_caminhoesRegistrados.html">CAMINHÕES</a>
            <a class="botao" href="opcoesCadastro.html">CADASTRO</a>

            <a id="botaoSair" href="../index.html">SAIR</a>

        </div>

    </div>

    <div id="containerTudo">

        <div class="containerTitulo">

            <h1 class="titulo">
                GRÁFICOS GERAIS
            </h1>

        </div>

        <div id="containerKpi">
            <div class="kpi kpiInstavel">
                <img src="../assets/imagens/temperaturaComAlerta.png">
                <span>
                    <h2>CAMINHÕES INSTÁVEIS</h2>
                    <h1 id="instaveis_gerais_temperatura"></h1>
                    <h4>Por Temperatura</h4>
                </span>
            </div>

            <div class="kpi kpiInstavel">
                <img src="../assets/imagens/umidadeComAlerta.png" class="iconeKpi">
                <span>
                    <h2>CAMINHÕES INSTÁVEIS</h2>
                    <h1 id="instaveis_gerais_umidade"></h1>
                    <h4>Por Umidade</h4>
                </span>
            </div>

            <div class="kpi">
                <img src="../assets/imagens/image 39.png" class="iconeKpi">
                <span>

                    <h2>PORCENTAGEM DE INSTÁVEIS</h2>
                    <h1 id="porcentagem_instaveis"></h1>
                </span>
            </div>

        </div>

        <div class="Filial">
            <div class="Linha">
                <div class="containerKPIFilial">
                    <h2>FILIAL A</h2>
                    <div class="KPiCaminhao">
                        <img src="../assets/imagens/caminhaozinho.png" alt="">
                        <span>

                            CAMINHÕES 5/24

                        </span>
                    </div>
                </div>
                <div class="containerKPIFilial">
                    <h2>FILIAL B</h2>
                    <div class="KPiCaminhao">
                        <img src="../assets/imagens/caminhaozinho.png" alt="">
                        <span>

                            CAMINHÕES 14/23

                        </span>
                    </div>
                </div>
                <div class="containerKPIFilial">
                    <h2>FILIAL C</h2>
                    <div class="KPiCaminhao">
                        <img src="../assets/imagens/caminhaozinho.png" alt="">
                        <span>

                            CAMINHÕES 7/31

                        </span>
                    </div>
                </div>
            </div>
            <div class="Linha">
                <div class="containerKPIFilial">
                    <h2>FILIAL D</h2>
                    <div class="KPiCaminhao">
                        <img src="../assets/imagens/caminhaozinho.png" alt="">
                        <span>

                            CAMINHÕES 5/27

                        </span>
                    </div>
                </div>
                <div class="containerKPIFilial">
                    <h2>FILIAL E</h2>
                    <div class="KPiCaminhao">
                        <img src="../assets/imagens/caminhaozinho.png" alt="">
                        <span>

                            CAMINHÕES 2/23

                        </span>
                    </div>
                </div>
                <div class="containerKPIFilial">
                    <h2>FILIAL F</h2>
                    <div class="KPiCaminhao">
                        <img src="../assets/imagens/caminhaozinho.png" alt="">
                        <span>

                            CAMINHÕES 2/15

                        </span>
                    </div>
                </div>
            </div>

        </div>

    </div>

</body>

</html>

<script>
    setInterval(pegarCaminhoesInstaveisPorTemperatura, 2000);
    setInterval(pegarCaminhoesInstaveisPorUmidade, 2000);
    setInterval(pegarPorcentagemInstaveis, 2000);
    pegarCaminhoesInstaveisPorTemperatura();
    pegarCaminhoesInstaveisPorUmidade();
    pegarPorcentagemInstaveis();

    function pegarCaminhoesInstaveisPorTemperatura() {
        var fkEmpresa = sessionStorage.getItem('ID_EMPRESA');

        var kpiTemperaturaInstavel = document.querySelector('#instaveis_gerais_temperatura');

        fetch(`/empresas/listarKpiTemperatura/${fkEmpresa}`)
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        sessionStorage.TEMPERATURA_INSTAVEL = resposta[0].instaveisGerais_temperatura;
                        kpiTemperaturaInstavel.innerHTML = sessionStorage.getItem('TEMPERATURA_INSTAVEL');
                    });
                } else {
                    console.log("Nenhum valor encontrado ou ocorreu algum erro na API!");
                    alert("Nenhum valor encontrado ou ocorreu algum erro na API!");
                }
            })
            .catch(function (error) {
                console.log(`Erro na captura dos dados para o gráfico: ${error.message}`);
                alert(`Erro na captura dos dados para o gráfico: ${error.message}`);
            });

        return false;

    }

    function pegarCaminhoesInstaveisPorUmidade() {
        var fkEmpresa = sessionStorage.getItem('ID_EMPRESA');

        var kpiUmidadeInstavel = document.querySelector('#instaveis_gerais_umidade');

        fetch(`/empresas/listarKpiUmidade/${fkEmpresa}`)
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        sessionStorage.UMIDADE_INSTAVEL = resposta[0].instaveisGerais_umidade;
                        kpiUmidadeInstavel.innerHTML = sessionStorage.getItem('UMIDADE_INSTAVEL');
                    });
                } else {
                    console.log("Nenhum valor encontrado ou ocorreu algum erro na API!");
                    alert("Nenhum valor encontrado ou ocorreu algum erro na API!");
                }
            })
            .catch(function (error) {
                console.log(`Erro na captura dos dados para o gráfico: ${error.message}`);
                alert(`Erro na captura dos dados para o gráfico: ${error.message}`);
            });

        return false;

    }

    function pegarPorcentagemInstaveis() {
        var fkEmpresa = sessionStorage.getItem("ID_EMPRESA");

        var kpiPorcentagemInstaveis = document.querySelector('#porcentagem_instaveis');

        fetch(`/empresas/pegarPorcentagemInstaveis/${fkEmpresa}`)
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        sessionStorage.PORCENTAGEM_INSTAVEIS = resposta[0].Porcentagem;
                        kpiPorcentagemInstaveis.innerHTML = `${sessionStorage.getItem('PORCENTAGEM_INSTAVEIS')}%`;
                    });
                } else {
                    console.log("Nenhum valor encontrado ou ocorreu algum erro na API!");
                    alert("Nenhum valor encontrado ou ocorreu algum erro na API!");
                }
            })
            .catch(function (error) {
                console.log(`Erro na captura dos dados para o gráfico: ${error.message}`);
                alert(`Erro na captura dos dados para o gráfico: ${error.message}`);
            });

        return false

    }

</script>